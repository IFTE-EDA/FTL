#image: carlonluca/qt-dev:6.0.4
image: 
  name: arnoldnico/ifte-ci:py3.10.4-tox-vedo-bookworm
#  name: arnoldnico/ifte-ci:py3.10.4-vedo-bullseye
  entrypoint: [ '/bin/bash', '-s' ]
 

 
stages:          # List of stages for jobs, and their order of execution
  - init
  - info
  - test
  - bye

initialize:
  stage: init
  script:
    - python --version
    - pip --version
    - which python3
    - which pip3
    - gpgconf --version
    - gpg-connect-agent --version
    - dirmngr --version
    - git submodule update --remote
    #- strip --remove-section=.note.ABI-tag /usr/lib/x86_64-linux-gnu/libQt6Core.so.6
    #- python3 -m pip install -i https://gmsh.info/python-packages-dev --force-reinstall --no-cache-dir gmsh
    - python3 -m pip install --progress-bar off --ignore-installed -r requirements.txt
    #- python3.5 --version
    #- export PATH="/opt/pyenv/bin:$PATH"
    - export PYENV_ROOT=/opt/pyenv
    - eval "$(pyenv init -)"
    - which python3
    #- locate libQt6Core.so.6

information:
  stage: info
  script:
    - pyenv versions
    - printenv
    - whoami

test_pytest:
  stage: test
  script:
    - pyenv versions
    - pytest tests/ --junitxml=pytest_report.xml
  artifacts:
    when: always
    reports:
      junit: pytest_report.xml

test_tox:
  stage: test
  script:
    - pyenv versions
    - tox
  #coverage: '/(?i)total.*? (100(?:\.0+)?\%|[1-9]?\d(?:\.\d+)?\%)$/'
  artifacts:
    when: always
    reports:
      junit: junit-*.xml
#      coverage_report:
#        coverage_format: cobertura
#        path: coverage.xml


goodbye:
  stage: bye
  script:
    - echo Goodbye

#include:
#- template: Code-Quality.gitlab-ci.yml